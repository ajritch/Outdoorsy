<!DOCTYPE html>
<html lang = "en">
	<head>
		<meta charset = "UTF-8">
		<title>Home Page</title>

		<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css">
		<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
		<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/js/bootstrap.min.js"></script>


		<!-- FB LOGIN STUFF -->
		<script>
		// This is called with the results from from FB.getLoginStatus().
		function statusChangeCallback(response) {
			console.log('statusChangeCallback');
			$('#fbtoken').val(response.authResponse['accessToken']);
			// console.log(response.authResponse['accessToken']);
			// The response object is returned with a status field that lets the
			// app know the current login status of the person.
			// Full docs on the response object can be found in the documentation
			// for FB.getLoginStatus().
			if (response.status === 'connected') {
				// Logged into your app and Facebook.
				testAPI();
			} else if (response.status === 'not_authorized') {
				// The person is logged into Facebook, but not your app.
				document.getElementById('status').innerHTML = 'Please log ' +
				  'into this app.';
			} else {
				// The person is not logged into Facebook, so we're not sure if
				// they are logged into this app or not.
				document.getElementById('status').innerHTML = 'Please log ' +
				  'into Facebook.';
			}
		}

		// This function is called when someone finishes with the Login
		// Button.  See the onlogin handler attached to it in the sample
		// code below.
		function checkLoginState() {
			FB.getLoginStatus(function(response) {
				statusChangeCallback(response);
			});
		}

		window.fbAsyncInit = function() {
			FB.init({
			appId      : 'KEEEY',
			cookie     : true,  // enable cookies to allow the server to access 
			// the session
			xfbml      : true,  // parse social plugins on this page
			version    : 'v2.5' // use graph api version 2.5
			});

			// Now that we've initialized the JavaScript SDK, we call 
			// FB.getLoginStatus().  This function gets the state of the
			// person visiting this page and can return one of three states to
			// the callback you provide.  They can be:
			//
			// 1. Logged into your app ('connected')
			// 2. Logged into Facebook, but not your app ('not_authorized')
			// 3. Not logged into Facebook and can't tell if they are logged into
			//    your app or not.
			//
			// These three cases are handled in the callback function.
			FB.getLoginStatus(function(response) {
				statusChangeCallback(response);
				// console.log('asdfasdf' + response)
			});
		};

		// Load the SDK asynchronously
		(function(d, s, id) {
			var js, fjs = d.getElementsByTagName(s)[0];
			if (d.getElementById(id)) return;
			js = d.createElement(s); js.id = id;
			js.src = "//connect.facebook.net/en_US/sdk.js#xfbml=1&version=v2.7&appId=KEEEY";
			fjs.parentNode.insertBefore(js, fjs);
		}(document, 'script', 'facebook-jssdk'));

		// Here we run a very simple test of the Graph API after login is
		// successful.  See statusChangeCallback() for when this call is made.
		function testAPI() {
		// console.log('Welcome!  Fetching your information.... ');
		FB.api('/me', function(response) {
			$('#fbname').val(response.name);
				$('#fbid').val(response.id);
				$('#fbid').change(function(){
					$('form').submit();
				});
				$.post('/register', $("form").serialize(), function(response) {
				  window.location.replace('/home')	
				});
				// console.log('.serialize' + fbname.value)
				// console.log('Successful login for: ' + response.name);
				// console.log(response)
				document.getElementById('status').innerHTML =
				'Thanks for logging in, ' + response.name + '!';
				document.getElementById('fbname').value = response.name
			}); 
		}

		</script>

	</head>
	<body>
		<style>
			.navbar {
				/*background-color: #90A964;*/
				background-color: #008080;
			}
			.navbar span {
				color: #fff;
			}
			.jumbotron {
				background-color: #90a964;
			}
			.jumbotron h1 {
				color: #fff;
			}
			.jumbotron p {
				color: #008080;
			}
			.subhead h4 {
				color: #008080;
			}

		</style>
		<nav class = 'navbar navbar-default'>
			<div class = 'container-fluid'>
				<div class = 'navbar-header'>
					<a class = 'navbar-brand navlink' href = "/"><span>Outdoorsy</span></a>
				</div>
				<ul class = 'nav navbar-nav'>
					<li><a href = '/' class = 'navlink'><span>Home</span></a></li>
				</ul>
				<!-- <ul class = 'nav navbar-nav navbar-right'>
					<li><a href="/login" class = 'navlink'><span>Sign In</span></a></li>
				</ul> -->
			</div>
		</nav>

		<div class = 'container'>
			<div class = 'jumbotron row'>
				<div id = 'words' class = 'col-md-7'>
					<h1>Welcome to Outdoorsy!</h1>
					<p>Here you can find information and directions for parks, trails, and other outdoor areas anywhere in the world.</p>
				<!-- <p><a class = 'btn btn-primary' href = "/login">Get started</a></p> -->
					<div class="fb-login-button" data-max-rows="1" data-size="medium" data-show-faces="true" data-auto-logout-link="true" onlogin="checkLoginState();"></div>
				</div>
				<div class = 'col-md-4'>
					<img id = 'big-logo' src = '/static/images/whiteTree.png' alt = 'tree logo' width = 270 height = 300>
				</div>
			</div>

			<div id="status">
			</div>

			<div id='registration'>
				<form action='/register' method='POST' id='fbuser'>
					<input type='hidden' id='fbname' name='fbname' value=''>
					<input type='hidden' id='fbid' name='fbid' value=''>
					<input type='hidden' id='fbtoken' name='fbtoken' value=''>
				</form>
			</div>

			<div class = 'col-sm-4 subhead'>
				<h4>Find nature</h4>
				<p>Search for outdoor and natural attractions in any area of the word.
				</p>
			</div>
			<div class = 'col-sm-4 subhead'>
				<h4>Read/write travel advice</h4>
				<p>Scour through our collection of users' travel tips, and write a few of your own on your favorite (or least favorite!) outdoor attractions.
				</p>
			</div>
			<div class = 'col-sm-4 subhead'>
				<h4>Get directions</h4>
				<p>Get directions to any outdoor location. Traveling by bike or by public transit? We've got you covered.
				</p>
			</div>
		</div> <!-- end of container -->
	</body>
</html>